@model DirtyCoins.Models.Customer
@{
    ViewData["Title"] = "Trang cá nhân khách hàng";
}

<style>
    .db-cus{
        margin: 80px auto 0px;
        padding-bottom: 40px;
    }
</style>

<div class="container dirtycoins-body db-cus">
    <div class="row g-4">
        <!-- CỘT TRÁI: Xin chào + Thông tin cá nhân -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm hover-glow p-4 h-100" style="border-radius:20px; background:linear-gradient(180deg, rgba(255, 255, 255, 0.95), rgba(255, 250, 235, 0.9));">
                <div class="text-center mb-4">
                    <h2 class="fw-bold" style="font-family:'Bebas Neue', sans-serif; color:var(--dc-dark); letter-spacing:1px;">
                        Xin chào, <span style="color:var(--dc-green)">@Model.FullName!</span>
                    </h2>
                    <p class="text-muted small">Chào mừng bạn quay lại DirtyCoins Studio 🖤</p>
                </div>

                <div class="border-top pt-3">
                    <h5 class="text-dark fw-bold mb-3">
                        <i class="bi bi-person-circle me-2 text-gold"></i>Thông tin cá nhân
                    </h5>

                    <p><strong>Email:</strong> @Model.User?.Email</p>
                    <p><strong>Điện thoại:</strong> @(string.IsNullOrEmpty(Model.Phone) ? "—" : Model.Phone)</p>
                    <p><strong>Địa chỉ:</strong> @(string.IsNullOrEmpty(Model.Address) ? "—" : Model.Address)</p>

                    <p class="text-muted small">
                        <i class="bi bi-calendar-check me-1"></i>
                        Tham gia từ: <strong>@ViewBag.CreatedAt.ToString("dd/MM/yyyy")</strong>
                    </p>

                    <div class="mt-4 p-3 rounded-4 shadow-sm" style="background:var(--dc-bg-soft);">
                        <h6 class="fw-bold mb-2">
                            <i class="bi bi-stars me-1 text-warning"></i> Hạng thành viên
                        </h6>

                        @{
                            string rankClass = ViewBag.RankName switch
                            {
                                "Diamond" => "background:linear-gradient(135deg,#00c6ff,#0072ff);color:white;",
                                "Gold" => "background:linear-gradient(135deg,#FFD700,#FFA500);color:black;",
                                "Silver" => "background:linear-gradient(135deg,#C0C0C0,#A9A9A9);color:black;",
                                _ => "background:linear-gradient(135deg,var(--dc-green),#0f0);color:white;"
                            };
                        }

                        <div class="d-flex align-items-center justify-content-between">
                            <div>
                                <span class="badge rounded-pill px-3 py-2 fw-semibold" style="@rankClass">
                                    @ViewBag.RankName
                                </span>
                                <p class="small text-muted mb-0">
                                    Ưu đãi: <span class="text-success fw-bold">@ViewBag.RankDiscount%</span> giảm giá sản phẩm
                                </p>
                            </div>
                            <i class="bi bi-trophy-fill fs-3 text-warning"></i>
                        </div>

                        <div class="mt-2 small text-muted">
                            Tổng chi tiêu: <span class="fw-bold text-dark">@ViewBag.TotalSpent.ToString("N0") ₫</span>
                        </div>
                    </div>

                    <a href="@Url.Action("Settings", "Customer")"
                       class="btn bg-gold fw-semibold rounded-pill w-100 mt-3 py-2 shadow-sm">
                        <i class="bi bi-pencil-square me-1"></i> Cập nhật thông tin
                    </a>
                </div>
            </div>
        </div>

        <!-- CỘT PHẢI: Đơn hàng gần đây -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm hover-glow p-4 h-100" style="border-radius:20px;">
                <h4 class="fw-bold mb-3" style="color:var(--dc-dark);">
                    <i class="bi bi-bag-check me-2 text-green"></i>Đơn hàng gần đây
                </h4>

                @if (Model.Orders != null && Model.Orders.Any())
                {
                    <div class="table-responsive">
                        <table class="table align-middle text-center table-borderless">
                            <thead style="background-color:var(--dc-dark); color:var(--dc-text-light); border-radius:12px;">
                                <tr>
                                    <th>Mã đơn</th>
                                    <th>Ngày đặt</th>
                                    <th>Tổng tiền</th>
                                    <th>Trạng thái</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var o in Model.Orders.OrderByDescending(x => x.OrderDate).Take(5))
                                {
                                    <tr class="border-bottom">
                                        <td class="fw-semibold">@o.OrderCode</td>
                                        <td>@o.OrderDate.ToString("dd/MM/yyyy")</td>
                                        <td class="fw-bold text-dark">@o.TotalAmount.ToString("N0") ₫</td>
                                        <td>
                                            <span class="badge @(o.Status switch
                                            {
                                                "Đang xử lý" => "bg-warning text-dark",
                                                "Chờ giao hàng" => "bg-info text-dark",
                                                "Đang giao hàng" => "bg-primary",
                                                "Giao hàng thành công" => "bg-success",
                                                "Đã hủy" => "bg-danger",
                                                _ => "bg-secondary"
                                            })">@o.Status</span>
                                        </td>
                                        <td>
                                            <a class="btn btn-sm bg-gold fw-semibold rounded-pill shadow-sm"
                                               href="@Url.Action("OrderDetail", "Customer", new { id = o.IdOrder })">
                                                <i class="bi bi-eye me-1"></i> Xem
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <div class="text-end mt-3">
                        <a href="@Url.Action("Orders", "Customer")"
                           class="btn btn-outline-dark rounded-pill px-4 py-2 fw-semibold hover-glow">
                            <i class="bi bi-list-ul me-1"></i> Xem tất cả đơn hàng
                        </a>
                    </div>
                }
                else
                {
                    <div class="text-center py-4 text-muted">
                        <i class="bi bi-inbox fs-3 d-block mb-2"></i>
                        Chưa có đơn hàng nào.
                    </div>
                }
            </div>
        </div>
    </div>
</div>
